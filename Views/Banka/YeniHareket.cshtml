@model MuhasebeStokWebApp.ViewModels.Banka.BankaHareketCreateViewModel
@{
    ViewData["Title"] = "Yeni Banka Hareketi";
    Layout = "~/Views/Shared/_Layout.cshtml";
    var banka = ViewBag.Banka as MuhasebeStokWebApp.ViewModels.Banka.BankaViewModel;
}

<div class="container-fluid">
    <div class="card">
        <div class="card-header bg-primary text-white">
            <div class="d-flex justify-content-between align-items-center">
                <h4 class="mb-0">Yeni Banka Hareketi</h4>
                <a asp-action="Hareketler" asp-route-id="@banka.BankaID" class="btn btn-light">
                    <i class="fas fa-arrow-left"></i> Hareketlere Dön
                </a>
            </div>
        </div>
        <div class="card-body">
            <!-- Banka Bilgileri -->
            <div class="row mb-4">
                <div class="col-md-6">
                    <div class="info-group">
                        <h6 class="f-w-600">Banka Hesabı</h6>
                        <p>@banka.BankaAdi - @banka.SubeAdi (@banka.HesapNo)</p>
                        <p class="text-muted">@banka.IBAN</p>
                    </div>
                </div>
                <div class="col-md-6 text-end">
                    <div class="info-group">
                        <h6 class="f-w-600">Güncel Bakiye</h6>
                        <p class="@(banka.GuncelBakiye >= 0 ? "text-success" : "text-danger") fw-bold">
                            @banka.GuncelBakiye.ToString("N2") @banka.ParaBirimi
                        </p>
                    </div>
                </div>
            </div>

            <form asp-action="YeniHareket">
                <div asp-validation-summary="ModelOnly" class="text-danger"></div>
                <input type="hidden" asp-for="BankaID" value="@banka.BankaID" />

                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group mb-3">
                            <label asp-for="HareketTuru" class="control-label"></label>
                            <select asp-for="HareketTuru" class="form-control select2">
                                <option value="">-- Hareket Türü Seçiniz --</option>
                                <option value="Para Yatırma">Para Yatırma</option>
                                <option value="Para Çekme">Para Çekme</option>
                                <option value="EFT Gönderme">EFT Gönderme</option>
                                <option value="EFT Alma">EFT Alma</option>
                                <option value="Havale Gönderme">Havale Gönderme</option>
                                <option value="Havale Alma">Havale Alma</option>
                            </select>
                            <span asp-validation-for="HareketTuru" class="text-danger"></span>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group mb-3">
                            <label asp-for="Tutar" class="control-label"></label>
                            <div class="input-group">
                                <input asp-for="Tutar" class="form-control" type="number" step="0.01" />
                                <span class="input-group-text">@banka.ParaBirimi</span>
                            </div>
                            <span asp-validation-for="Tutar" class="text-danger"></span>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group mb-3">
                            <label asp-for="CariID" class="control-label">Cari</label>
                            <select asp-for="CariID" class="form-control select2" asp-items="ViewBag.Cariler">
                                <option value="">-- Cari Seçiniz --</option>
                            </select>
                            <span asp-validation-for="CariID" class="text-danger"></span>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group mb-3">
                            <label asp-for="KarsiUnvan" class="control-label"></label>
                            <input asp-for="KarsiUnvan" class="form-control" />
                            <span asp-validation-for="KarsiUnvan" class="text-danger"></span>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group mb-3">
                            <label asp-for="KarsiBankaAdi" class="control-label"></label>
                            <input asp-for="KarsiBankaAdi" class="form-control" />
                            <span asp-validation-for="KarsiBankaAdi" class="text-danger"></span>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group mb-3">
                            <label asp-for="KarsiIBAN" class="control-label"></label>
                            <input asp-for="KarsiIBAN" class="form-control" />
                            <span asp-validation-for="KarsiIBAN" class="text-danger"></span>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group mb-3">
                            <label asp-for="DekontNo" class="control-label"></label>
                            <input asp-for="DekontNo" class="form-control" />
                            <span asp-validation-for="DekontNo" class="text-danger"></span>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group mb-3">
                            <label asp-for="ReferansNo" class="control-label"></label>
                            <input asp-for="ReferansNo" class="form-control" />
                            <span asp-validation-for="ReferansNo" class="text-danger"></span>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-12">
                        <div class="form-group mb-3">
                            <label asp-for="Aciklama" class="control-label"></label>
                            <textarea asp-for="Aciklama" class="form-control" rows="3"></textarea>
                            <span asp-validation-for="Aciklama" class="text-danger"></span>
                        </div>
                    </div>
                </div>

                <div class="form-group mt-4 text-end">
                    <a asp-action="Hareketler" asp-route-id="@banka.BankaID" class="btn btn-secondary">
                        <i class="fas fa-times"></i> İptal
                    </a>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> Kaydet
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
    
    <script>
        $(document).ready(function() {
            $('.select2').select2();

            // Hareket türü değiştiğinde karşı banka ve IBAN alanlarını göster/gizle
            $('#HareketTuru').change(function() {
                var selectedValue = $(this).val();
                var isTransfer = selectedValue.includes('EFT') || selectedValue.includes('Havale');
                
                if (isTransfer) {
                    $('#KarsiBankaAdi').closest('.form-group').show();
                    $('#KarsiIBAN').closest('.form-group').show();
                } else {
                    $('#KarsiBankaAdi').closest('.form-group').hide();
                    $('#KarsiIBAN').closest('.form-group').hide();
                }
            });

            // Sayfa yüklendiğinde de kontrol et
            $('#HareketTuru').trigger('change');
        });
    </script>
} 