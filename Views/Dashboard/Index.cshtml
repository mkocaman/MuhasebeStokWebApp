@model MuhasebeStokWebApp.ViewModels.Dashboard.DashboardViewModel
@{
    ViewData["Title"] = "Yönetici Paneli";
    ViewData["ActiveMenu"] = "Dashboard";
    
    // Para birimi sembolleri
    Dictionary<string, string> paraBirimiSembolleri = new Dictionary<string, string>
    {
        { "USD", "$" },
        { "TRY", "₺" },
        { "EUR", "€" },
        { "UZS", "so'm" },
        { "GBP", "£" }
    };
    
    // Formatla: Ondalık sayı formatı
    string FormatDecimal(decimal value)
    {
        return value.ToString("N2");
    }
}

<div class="container-fluid dashboard-default-sec">
    <div class="row">
        <div class="col-xl-5 box-col-12 des-xl-100"> 
            <div class="row">
                <div class="col-xl-12 col-md-6 box-col-6 des-xl-50">
                    <div class="card profile-greeting">
                        <div class="card-header">
                            <div class="header-top">
                                <div class="setting-list bg-primary position-unset">
                                    <ul class="list-unstyled setting-option">
                                        <li>
                                            <div class="setting-white"><i class="icon-settings"></i></div>
                                        </li>
                                        <li><i class="icofont icofont-maximize full-card font-white"></i></li>
                                        <li><i class="icofont icofont-minus minimize-card font-white"></i></li>
                                        <li><i class="icofont icofont-refresh reload-card font-white"></i></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div class="card-body text-center p-t-0">
                            <h3 class="font-light">Hoş Geldiniz!</h3>
                            <p>Muhasebe ve Stok Yönetim Paneline hoş geldiniz. İşletmenizin finansal ve stok durumunu kolayca takip edebilirsiniz.</p>
                            <a href="/Home" class="btn btn-light">Ana Sayfaya Git</a>
                        </div>
                        <div class="confetti">
                            <div class="confetti-piece"></div>
                            <div class="confetti-piece"></div>
                            <div class="confetti-piece"></div>
                            <div class="confetti-piece"></div>
                            <div class="confetti-piece"></div>
                            <div class="confetti-piece"></div>
                            <div class="confetti-piece"></div>
                            <div class="confetti-piece"></div>
                            <div class="confetti-piece"></div>
                            <div class="confetti-piece"></div>
                            <div class="confetti-piece"></div>
                            <div class="confetti-piece"></div>
                            <div class="confetti-piece"></div>
                        </div>
                    </div>
                </div>
                <div class="col-xl-6 col-md-3 col-sm-6 box-col-3 des-xl-25 rate-sec">
                    <div class="card income-card card-primary">                                 
                        <div class="card-body text-center">                                  
                            <div class="round-box">
                                <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewbox="0 0 448.057 448.057" style="enable-background:new 0 0 448.057 448.057;" xml:space="preserve">
                                    <g>
                                        <g>
                                            <path d="M404.562,7.468c-0.021-0.017-0.041-0.034-0.062-0.051c-13.577-11.314-33.755-9.479-45.069,4.099                                            c-0.017,0.02-0.034,0.041-0.051,0.062l-135.36,162.56L88.66,11.577C77.35-2.031,57.149-3.894,43.54,7.417                                            c-13.608,11.311-15.471,31.512-4.16,45.12l129.6,155.52h-40.96c-17.673,0-32,14.327-32,32s14.327,32,32,32h64v144                                            c0,17.673,14.327,32,32,32c17.673,0,32-14.327,32-32v-180.48l152.64-183.04C419.974,38.96,418.139,18.782,404.562,7.468z"></path>
                                        </g>
                                    </g>
                                    <g>
                                        <g>
                                            <path d="M320.02,208.057h-16c-17.673,0-32,14.327-32,32s14.327,32,32,32h16c17.673,0,32-14.327,32-32                                            S337.694,208.057,320.02,208.057z"></path>
                                        </g>
                                    </g>
                                </svg>
                            </div>
                            <h5>@FormatDecimal(Model.PaymentReceiptSummary.ToplamTahsilat)</h5>
                            <p>Toplam Tahsilat (USD)</p><a class="btn-arrow arrow-primary" href="javascript:void(0)"><i class="toprightarrow-primary fa fa-arrow-up me-2"></i>%@FormatDecimal(Model.DailyActivity?.GunlukArtisYuzdesi ?? 0) </a>
                        </div>
                    </div>
                </div>
                <div class="col-xl-6 col-md-3 col-sm-6 box-col-3 des-xl-25 rate-sec">
                    <div class="card income-card card-secondary">                                    
                        <div class="card-body text-center">
                            <div class="round-box">
                                <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewbox="0 0 512 512" style="enable-background:new 0 0 512 512;" xml:space="preserve">
                                    <g>
                                        <g>
                                            <path d="M256,0C114.615,0,0,114.615,0,256s114.615,256,256,256s256-114.615,256-256S397.385,0,256,0z M96,100.16                                            c50.315,35.939,80.124,94.008,80,155.84c0.151,61.839-29.664,119.919-80,155.84C11.45,325.148,11.45,186.851,96,100.16z M256,480                                            c-49.143,0.007-96.907-16.252-135.84-46.24C175.636,391.51,208.14,325.732,208,256c0.077-69.709-32.489-135.434-88-177.6                                            c80.1-61.905,191.9-61.905,272,0c-98.174,75.276-116.737,215.885-41.461,314.059c11.944,15.577,25.884,29.517,41.461,41.461                                            C353.003,463.884,305.179,480.088,256,480z M416,412v-0.16c-86.068-61.18-106.244-180.548-45.064-266.616                                            c12.395-17.437,27.627-32.669,45.064-45.064C500.654,186.871,500.654,325.289,416,412z"></path>
                                        </g>
                                    </g>
                                </svg>
                            </div>
                            <h5>@FormatDecimal(Model.PaymentReceiptSummary.ToplamOdeme)</h5>
                            <p>Toplam Ödeme (USD)</p><a class="btn-arrow arrow-secondary" href="javascript:void(0)"><i class="toprightarrow-secondary fa fa-arrow-up me-2"></i>%@FormatDecimal(Model.DailyActivity?.GunlukArtisYuzdesi ?? 0)</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-xl-7 box-col-12 des-xl-100 dashboard-sec">
            <div class="card income-card">
                <div class="card-header">
                    <div class="header-top d-sm-flex align-items-center">
                        <h5>Satış Genel Bakış</h5>
                        <div class="center-content">
                            <p class="d-sm-flex align-items-center"><span class="font-primary m-r-10 f-w-700">$@FormatDecimal(Model.ProfitMargin.ToplamSatisTutari)</span><i class="toprightarrow-primary fa fa-arrow-up m-r-10"></i>%@FormatDecimal(Model.ProfitMargin.KarMarjiYuzdesi) Geçen yıla göre</p>
                        </div>
                        <div class="setting-list">
                            <ul class="list-unstyled setting-option">
                                <li>
                                    <div class="setting-primary"><i class="icon-settings"></i></div>
                                </li>
                                <li><i class="icofont icofont-maximize full-card font-primary"></i></li>
                                <li><i class="icofont icofont-minus minimize-card font-primary"></i></li>
                                <li><i class="icofont icofont-refresh reload-card font-primary"></i></li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="card-body p-0">
                    <div id="chart-timeline-dashbord">
                        <canvas id="monthlySalesTrendChart" style="width:100%; height:350px;"></canvas>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-xl-8 box-col-12 des-xl-100">
            <div class="row">
                <div class="col-xl-6 col-50 box-col-6 des-xl-50">
                    <div class="card">
                        <div class="card-header">
                            <div class="header-top d-sm-flex align-items-center">
                                <h5>Büyüme Analizi</h5>
                                <div class="center-content">
                                    <p class="d-flex align-items-center"><i class="toprightarrow-primary fa fa-arrow-up me-2"></i>%@FormatDecimal(Model.DailyActivity?.GunlukArtisYuzdesi ?? 0) Büyüme</p>
                                </div>
                                <div class="setting-list">
                                    <ul class="list-unstyled setting-option">
                                        <li>
                                            <div class="setting-primary"><i class="icon-settings"></i></div>
                                        </li>
                                        <li><i class="icofont icofont-maximize full-card font-primary"></i></li>
                                        <li><i class="icofont icofont-minus minimize-card font-primary"></i></li>
                                        <li><i class="icofont icofont-refresh reload-card font-primary"></i></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div class="card-body p-0">
                            <div id="chart-dashbord">
                                <canvas id="topSellingProductsChart" style="width:100%; height:300px;"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-xl-6 col-50 box-col-6 des-xl-50">
                    <div class="card latest-update-sec">
                        <div class="card-header">
                            <div class="header-top d-sm-flex align-items-center">
                                <h5>Son Aktiviteler</h5>
                                <div class="center-content">
                                    <ul class="week-date">
                                        <li class="font-primary">Bugün</li>
                                        <li>Bu Ay</li>
                                    </ul>
                                </div>
                                <div class="setting-list">
                                    <ul class="list-unstyled setting-option">
                                        <li>
                                            <div class="setting-primary"><i class="icon-settings"></i></div>
                                        </li>
                                        <li><i class="icofont icofont-maximize full-card font-primary"></i></li>
                                        <li><i class="icofont icofont-minus minimize-card font-primary"></i></li>
                                        <li><i class="icofont icofont-refresh reload-card font-primary"></i></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-bordernone">
                                    <tbody>
                                        @foreach (var fatura in Model.RecentInvoices)
                                        {
                                            <tr>
                                                <td>
                                                    <div class="media">
                                                        <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewbox="0 0 512.001 512.001" style="enable-background:new 0 0 512.001 512.001;" xml:space="preserve">
                                                            <g>
                                                                <g>
                                                                    <path d="M506.35,80.699c-7.57-7.589-19.834-7.609-27.43-0.052L331.662,227.31l-42.557-42.557c-7.577-7.57-19.846-7.577-27.423,0                                                      L89.076,357.36c-7.577,7.57-7.577,19.853,0,27.423c3.782,3.788,8.747,5.682,13.712,5.682c4.958,0,9.93-1.894,13.711-5.682                                                      l158.895-158.888l42.531,42.524c7.57,7.57,19.808,7.577,27.397,0.032l160.97-160.323                                                      C513.881,100.571,513.907,88.288,506.35,80.699z"></path>
                                                                </g>
                                                            </g>
                                                            <g>
                                                                <g>
                                                                    <path d="M491.96,449.94H38.788V42.667c0-10.712-8.682-19.394-19.394-19.394S0,31.955,0,42.667v426.667                                                      c0,10.712,8.682,19.394,19.394,19.394H491.96c10.712,0,19.394-8.682,19.394-19.394C511.354,458.622,502.672,449.94,491.96,449.94z                                                      "></path>
                                                                </g>
                                                            </g>
                                                            <g>
                                                                <g>
                                                                    <path d="M492.606,74.344H347.152c-10.712,0-19.394,8.682-19.394,19.394s8.682,19.394,19.394,19.394h126.061v126.067                                                      c0,10.705,8.682,19.394,19.394,19.394S512,249.904,512,239.192V93.738C512,83.026,503.318,74.344,492.606,74.344z"></path>
                                                                </g>
                                                            </g>
                                                        </svg>
                                                        <div class="media-body">
                                                            <span>@fatura.CariAdi - @fatura.FaturaNo</span>
                                                            <p>@fatura.FaturaTarihi?.ToString("dd.MM.yyyy")</p>
                                                        </div>
                                                    </div>
                                                </td>
                                                <td><a href="/Fatura/Details/@fatura.FaturaID" target="_blank">Görüntüle</a></td>
                                                <td>
                                                    <span class="badge badge-light-@(fatura.OdemeDurumu == "Ödendi" ? "success" : "warning")">@fatura.OdemeDurumu</span>
                                                </td>
                                            </tr>
                                        }
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="col-xl-12 recent-order-sec">
                    <div class="card">
                        <div class="card-body">
                            <div class="table-responsive">
                                <h5>Son Siparişler</h5>
                                <table class="table table-bordernone">                                         
                                    <thead>
                                        <tr>                                        
                                            <th>Ürün</th>
                                            <th>Tarih</th>
                                            <th>Miktar</th>
                                            <th>Trend</th>
                                            <th>Değer</th>
                                            <th>Durum</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @foreach (var product in Model.TopSellingProducts.Take(5))
                                        {
                                            <tr>
                                                <td>
                                                    <div class="media">
                                                        <img class="img-fluid rounded-circle" src="/assets/images/dashboard/product-1.png" alt="" data-original-title="" title="">
                                                        <div class="media-body">
                                                            <a href="javascript:void(0)"><span>@product.UrunAdi</span></a>
                                                        </div>
                                                    </div>
                                                </td>
                                                <td>
                                                    <p>@DateTime.Now.AddDays(-new Random().Next(1, 30)).ToString("dd MMMM")</p>
                                                </td>
                                                <td>
                                                    <p>@product.SatisMiktari.ToString("N2")</p>
                                                </td>
                                                <td><img class="img-fluid" src="/assets/images/dashboard/graph-1.png" alt="" data-original-title="" title=""></td>
                                                <td>
                                                    <p>$@FormatDecimal(product.BirimFiyat * product.SatisMiktari)</p>
                                                </td>
                                                <td>
                                                    <p>Tamamlandı</p>
                                                </td>
                                            </tr>
                                        }
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-xl-4 box-col-12 des-xl-100">
            <div class="row">
                <div class="col-xl-12 box-col-6 des-xl-50">
                    <div class="card">
                        <div class="card-header">
                            <div class="header-top d-sm-flex align-items-center">
                                <h5>Kullanıcı Aktiviteleri</h5>
                                <div class="center-content">
                                    <p>Yıllık İstatistik</p>
                                </div>
                                <div class="setting-list">
                                    <ul class="list-unstyled setting-option">
                                        <li>
                                            <div class="setting-primary"><i class="icon-settings"></i></div>
                                        </li>
                                        <li><i class="icofont icofont-maximize full-card font-primary"></i></li>
                                        <li><i class="icofont icofont-minus minimize-card font-primary"></i></li>
                                        <li><i class="icofont icofont-refresh reload-card font-primary"></i></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div class="card-body p-0">
                            <div id="user-activation-dash-2">
                                <canvas id="topCustomersChart" style="width:100%; height:320px;"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="col-xl-12 box-col-6 des-xl-50">
                    <div class="card">
                        <div class="card-header">
                            <div class="header-top d-sm-flex align-items-center">
                                <h5>Kritik Stok Ürünleri</h5>
                                <div class="center-content">
                                    <p>Toplam @Model.CriticalStockProducts.Count() ürün</p>
                                </div>
                                <div class="setting-list">
                                    <ul class="list-unstyled setting-option">
                                        <li>
                                            <div class="setting-primary"><i class="icon-settings"></i></div>
                                        </li>
                                        <li><i class="icofont icofont-maximize full-card font-primary"></i></li>
                                        <li><i class="icofont icofont-minus minimize-card font-primary"></i></li>
                                        <li><i class="icofont icofont-refresh reload-card font-primary"></i></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div class="card-body px-0">
                            <div class="table-responsive">
                                <table class="table table-bordernone">
                                    <thead>
                                        <tr>
                                            <th>Ürün</th>
                                            <th>Mevcut</th>
                                            <th>Kritik</th>
                                            <th>Durum</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @foreach (var urun in Model.CriticalStockProducts.Take(5))
                                        {
                                            var durum = urun.MevcutMiktar <= 0 ? "Stokta Yok" : (urun.MevcutMiktar < urun.KritikSeviye ? "Kritik Seviye" : "Normal");
                                            var durumClass = urun.MevcutMiktar <= 0 ? "danger" : (urun.MevcutMiktar < urun.KritikSeviye ? "warning" : "success");
                                            
                                            <tr>
                                                <td>
                                                    <div class="media">
                                                        <img class="img-fluid rounded-circle" src="/assets/images/dashboard/product-1.png" alt="" data-original-title="" title="">
                                                        <div class="media-body">
                                                            <span>@urun.UrunAdi</span>
                                                        </div>
                                                    </div>
                                                </td>
                                                <td>
                                                    <p>@urun.MevcutMiktar.ToString("N2")</p>
                                                </td>
                                                <td>
                                                    <p>@urun.KritikSeviye.ToString("N2")</p>
                                                </td>
                                                <td>
                                                    <div class="span badge badge-light-@durumClass">@durum</div>
                                                </td>
                                            </tr>
                                        }
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <!-- Chart.js kütüphanesini ekle -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <script>
        $(document).ready(function() {
            // En Çok Satılan Ürünler (Bar Chart)
            var topProductsCtx = document.getElementById('topSellingProductsChart').getContext('2d');
            var topProductsData = {
                labels: [@Html.Raw(string.Join(",", Model.TopSellingProducts.Select(p => $"'{p.UrunAdi}'")))],
                datasets: [{
                    label: 'Satış Miktarı',
                    data: [@string.Join(",", Model.TopSellingProducts.Select(p => p.ToplamSatisMiktari))],
                    backgroundColor: 'rgba(78, 115, 223, 0.7)',
                    borderColor: 'rgba(78, 115, 223, 1)',
                    borderWidth: 1
                }]
            };
            var topProductsChart = new Chart(topProductsCtx, {
                type: 'bar',
                data: topProductsData,
                options: {
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
            
            // En Çok Satış Yapılan Cariler (Pie Chart)
            var topCustomersCtx = document.getElementById('topCustomersChart').getContext('2d');
            var topCustomersData = {
                labels: [@Html.Raw(string.Join(",", Model.TopCustomers.Select(c => $"'{c.CariAdi}'")))],
                datasets: [{
                    data: [@string.Join(",", Model.TopCustomers.Select(c => c.ToplamCiro))],
                    backgroundColor: ['#4e73df', '#1cc88a', '#36b9cc', '#f6c23e', '#e74a3b', '#858796'],
                    hoverBackgroundColor: ['#2e59d9', '#17a673', '#2c9faf', '#dda20a', '#be2617', '#60616f'],
                    hoverBorderColor: "rgba(234, 236, 244, 1)",
                }]
            };
            var topCustomersChart = new Chart(topCustomersCtx, {
                type: 'doughnut',
                data: topCustomersData,
                options: {
                    maintainAspectRatio: false,
                    tooltips: {
                        backgroundColor: "rgb(255,255,255)",
                        bodyFontColor: "#858796",
                        borderColor: '#dddfeb',
                        borderWidth: 1,
                        xPadding: 15,
                        yPadding: 15,
                        displayColors: false,
                        caretPadding: 10,
                    },
                    legend: {
                        display: true,
                        position: 'bottom'
                    },
                    cutoutPercentage: 70,
                },
            });
            
            // Aylık Satış Trendi (Line Chart)
            var salesTrendCtx = document.getElementById('monthlySalesTrendChart').getContext('2d');
            
            // Son 6 ay için etiketleri ve verileri oluştur
            var months = [];
            var now = new Date();
            for (var i = 5; i >= 0; i--) {
                var month = new Date(now.getFullYear(), now.getMonth() - i, 1);
                var monthName = month.toLocaleString('tr-TR', { month: 'short' });
                months.push(monthName);
            }
            
            // Rastgele satış verileri oluştur (gerçek verileri buraya entegre edebilirsiniz)
            var salesData = Model.DailyActivity?.GunlukSatisVerileri?.map(x => x.SatisTutari) || 
                [@(new Random().Next(5000, 15000)), @(new Random().Next(5000, 15000)), @(new Random().Next(5000, 15000)), 
                 @(new Random().Next(5000, 15000)), @(new Random().Next(5000, 15000)), @(new Random().Next(5000, 15000))];
            
            var salesTrendData = {
                labels: months,
                datasets: [{
                    label: "Satış Tutarı",
                    lineTension: 0.3,
                    backgroundColor: "rgba(78, 115, 223, 0.05)",
                    borderColor: "rgba(78, 115, 223, 1)",
                    pointRadius: 3,
                    pointBackgroundColor: "rgba(78, 115, 223, 1)",
                    pointBorderColor: "rgba(78, 115, 223, 1)",
                    pointHoverRadius: 3,
                    pointHoverBackgroundColor: "rgba(78, 115, 223, 1)",
                    pointHoverBorderColor: "rgba(78, 115, 223, 1)",
                    pointHitRadius: 10,
                    pointBorderWidth: 2,
                    data: salesData,
                }],
            };
            
            var salesTrendChart = new Chart(salesTrendCtx, {
                type: 'line',
                data: salesTrendData,
                options: {
                    maintainAspectRatio: false,
                    layout: {
                        padding: {
                            left: 10,
                            right: 25,
                            top: 25,
                            bottom: 0
                        }
                    },
                    scales: {
                        xAxes: [{
                            time: {
                                unit: 'date'
                            },
                            gridLines: {
                                display: false,
                                drawBorder: false
                            },
                            ticks: {
                                maxTicksLimit: 7
                            }
                        }],
                        yAxes: [{
                            ticks: {
                                maxTicksLimit: 5,
                                padding: 10,
                                // Include a dollar sign in the ticks
                                callback: function(value, index, values) {
                                    return '$' + value.toFixed(2);
                                }
                            },
                            gridLines: {
                                color: "rgb(234, 236, 244)",
                                zeroLineColor: "rgb(234, 236, 244)",
                                drawBorder: false,
                                borderDash: [2],
                                zeroLineBorderDash: [2]
                            }
                        }],
                    },
                    legend: {
                        display: false
                    },
                    tooltips: {
                        backgroundColor: "rgb(255,255,255)",
                        bodyFontColor: "#858796",
                        titleMarginBottom: 10,
                        titleFontColor: '#6e707e',
                        titleFontSize: 14,
                        borderColor: '#dddfeb',
                        borderWidth: 1,
                        xPadding: 15,
                        yPadding: 15,
                        displayColors: false,
                        intersect: false,
                        mode: 'index',
                        caretPadding: 10,
                        callbacks: {
                            label: function(tooltipItem, chart) {
                                var datasetLabel = chart.datasets[tooltipItem.datasetIndex].label || '';
                                return datasetLabel + ': $' + tooltipItem.yLabel.toFixed(2);
                            }
                        }
                    }
                }
            });
        });
    </script>
} 