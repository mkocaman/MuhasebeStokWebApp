@model MuhasebeStokWebApp.Data.Entities.ParaBirimiIliski

<div class="card">
    <div class="card-header">
        <h4 class="card-title">Para Birimi İlişki Detayı</h4>
    </div>
    <div class="card-body">
        @if (Model == null)
        {
            <div class="alert alert-warning">
                Bu para birimleri arasında tanımlı bir ilişki bulunamadı. 
                <button type="button" id="btnYeniIliski" class="btn btn-sm btn-primary ms-2">Yeni İlişki Oluştur</button>
            </div>
            
            <div id="yeniIliskiForm" class="mt-3 d-none">
                <form id="formIliski" method="post">
                    <input type="hidden" id="kaynakParaBirimiID" name="KaynakParaBirimiID" />
                    <input type="hidden" id="hedefParaBirimiID" name="HedefParaBirimiID" />
                    
                    <div class="mb-3">
                        <label class="form-label">Çarpan (Dönüşüm Oranı)</label>
                        <input type="number" id="carpan" name="Carpan" class="form-control" step="0.0001" min="0.0001" required />
                        <div class="form-text">Bu değer, kaynak para biriminden hedef para birimine dönüşüm oranını belirtir.</div>
                    </div>
                    
                    <div class="mb-3">
                        <button type="submit" class="btn btn-primary">Kaydet</button>
                        <button type="button" id="btnIptal" class="btn btn-secondary">İptal</button>
                    </div>
                </form>
            </div>
        }
        else
        {
            <div class="row mb-3">
                <div class="col-md-6">
                    <div class="mb-2">
                        <strong>Kaynak Para Birimi:</strong>
                        <span>@Model.KaynakParaBirimi?.Ad (@Model.KaynakParaBirimi?.Kod)</span>
                    </div>
                    <div class="mb-2">
                        <strong>Hedef Para Birimi:</strong>
                        <span>@Model.HedefParaBirimi?.Ad (@Model.HedefParaBirimi?.Kod)</span>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="mb-2">
                        <strong>Dönüşüm Oranı:</strong>
                        <span>@Model.Carpan.ToString("N4")</span>
                    </div>
                    <div class="mb-2">
                        <strong>Son Güncelleme:</strong>
                        <span>@Model.GuncellemeTarihi.ToString("dd.MM.yyyy HH:mm")</span>
                    </div>
                </div>
            </div>
            
            <div class="mb-3">
                <button type="button" id="btnDuzenle" class="btn btn-warning">Düzenle</button>
            </div>
            
            <div id="duzenleForm" class="mt-3 d-none">
                <form id="formIliskiDuzenle" method="post">
                    <input type="hidden" name="ParaBirimiIliskiID" value="@Model.ParaBirimiIliskiID" />
                    <input type="hidden" name="KaynakParaBirimiID" value="@Model.KaynakParaBirimiID" />
                    <input type="hidden" name="HedefParaBirimiID" value="@Model.HedefParaBirimiID" />
                    
                    <div class="mb-3">
                        <label class="form-label">Çarpan (Dönüşüm Oranı)</label>
                        <input type="number" name="Carpan" class="form-control" step="0.0001" min="0.0001" value="@Model.Carpan" required />
                        <div class="form-text">Bu değer, kaynak para biriminden hedef para birimine dönüşüm oranını belirtir.</div>
                    </div>
                    
                    <div class="mb-3">
                        <button type="submit" class="btn btn-primary">Güncelle</button>
                        <button type="button" id="btnIptalDuzenle" class="btn btn-secondary">İptal</button>
                    </div>
                </form>
            </div>
        }
    </div>
</div>

<script>
    $(document).ready(function() {
        $("#btnYeniIliski").click(function() {
            $("#kaynakParaBirimiID").val($("#kaynakParaBirimi").val());
            $("#hedefParaBirimiID").val($("#hedefParaBirimi").val());
            $("#yeniIliskiForm").removeClass("d-none");
            $(this).addClass("d-none");
        });
        
        $("#btnIptal").click(function() {
            $("#yeniIliskiForm").addClass("d-none");
            $("#btnYeniIliski").removeClass("d-none");
        });
        
        $("#formIliski").submit(function(e) {
            e.preventDefault();
            
            $.ajax({
                url: '@Url.Action("IliskiGuncelle", "Kur")',
                type: 'POST',
                data: $(this).serialize(),
                success: function(result) {
                    if (result.basari) {
                        alert(result.mesaj);
                        $("#btnIliskiSorgula").click(); // Sayfayı yenile
                    } else {
                        alert("Hata: " + result.hata);
                    }
                },
                error: function(error) {
                    alert("İşlem sırasında bir hata oluştu.");
                    console.error(error);
                }
            });
        });
        
        $("#btnDuzenle").click(function() {
            $("#duzenleForm").removeClass("d-none");
            $(this).addClass("d-none");
        });
        
        $("#btnIptalDuzenle").click(function() {
            $("#duzenleForm").addClass("d-none");
            $("#btnDuzenle").removeClass("d-none");
        });
        
        $("#formIliskiDuzenle").submit(function(e) {
            e.preventDefault();
            
            $.ajax({
                url: '@Url.Action("IliskiGuncelle", "Kur")',
                type: 'POST',
                data: $(this).serialize(),
                success: function(result) {
                    if (result.basari) {
                        alert(result.mesaj);
                        $("#btnIliskiSorgula").click(); // Sayfayı yenile
                    } else {
                        alert("Hata: " + result.hata);
                    }
                },
                error: function(error) {
                    alert("İşlem sırasında bir hata oluştu.");
                    console.error(error);
                }
            });
        });
    });
</script> 