@model MuhasebeStokWebApp.ViewModels.ParaBirimi.ParaBirimiIliskiViewModel

@{
    ViewData["Title"] = "Para Birimi İlişkileri";
}

<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <h5 class="card-title">Para Birimi İlişkileri</h5>
                </div>
                <div class="card-body">
                    @if (TempData["SuccessMessage"] != null)
                    {
                        <div class="alert alert-success alert-dismissible fade show" role="alert">
                            @TempData["SuccessMessage"]
                            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                        </div>
                    }

                    @if (TempData["ErrorMessage"] != null)
                    {
                        <div class="alert alert-danger alert-dismissible fade show" role="alert">
                            @TempData["ErrorMessage"]
                            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                        </div>
                    }

                    <div class="row mb-4">
                        <div class="col-md-12">
                            <div class="card">
                                <div class="card-header bg-light">
                                    <h6 class="card-title">Yeni Para Birimi İlişkisi Ekle</h6>
                                </div>
                                <div class="card-body">
                                    <form asp-action="Create" method="post">
                                        <div asp-validation-summary="ModelOnly" class="text-danger"></div>

                                        <div class="row">
                                            <div class="col-md-4">
                                                <div class="form-group">
                                                    <label asp-for="KaynakParaBirimiID" class="control-label">Kaynak Para Birimi</label>
                                                    <select asp-for="KaynakParaBirimiID" class="form-control">
                                                        <option value="">--- Kaynak Para Birimi Seçiniz ---</option>
                                                        @foreach (var paraBirimi in ViewBag.ParaBirimleri)
                                                        {
                                                            <option value="@paraBirimi.ParaBirimiID">@paraBirimi.Kod (@paraBirimi.Ad)</option>
                                                        }
                                                    </select>
                                                    <span asp-validation-for="KaynakParaBirimiID" class="text-danger"></span>
                                                </div>
                                            </div>
                                            <div class="col-md-4">
                                                <div class="form-group">
                                                    <label asp-for="HedefParaBirimiID" class="control-label">Hedef Para Birimi</label>
                                                    <select asp-for="HedefParaBirimiID" class="form-control">
                                                        <option value="">--- Hedef Para Birimi Seçiniz ---</option>
                                                        @foreach (var paraBirimi in ViewBag.ParaBirimleri)
                                                        {
                                                            <option value="@paraBirimi.ParaBirimiID">@paraBirimi.Kod (@paraBirimi.Ad)</option>
                                                        }
                                                    </select>
                                                    <span asp-validation-for="HedefParaBirimiID" class="text-danger"></span>
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                                <div class="form-group">
                                                    <label asp-for="CevrimKatsayisi" class="control-label">Çevrim Katsayısı</label>
                                                    <input asp-for="CevrimKatsayisi" class="form-control" />
                                                    <span asp-validation-for="CevrimKatsayisi" class="text-danger"></span>
                                                </div>
                                            </div>
                                            <div class="col-md-1">
                                                <button type="submit" class="btn btn-success btn-sm mt-4">
                                                    <i class="fa fa-plus"></i> Ekle
                                                </button>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="table-responsive mt-4">
                        <table id="paraBirimiIliskileriTable" class="table table-bordered table-striped table-hover">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Kaynak Para Birimi</th>
                                    <th>Hedef Para Birimi</th>
                                    <th>Çevrim Katsayısı</th>
                                    <th>Durum</th>
                                    <th>İşlemler</th>
                                </tr>
                            </thead>
                            <tbody>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}

    <script>
        $(document).ready(function () {
            // DataTable oluşturma
            var table = $('#paraBirimiIliskileriTable').DataTable({
                "ajax": {
                    "url": "@Url.Action("GetAllParaBirimiIliskileri", "ParaBirimiIliski")",
                    "type": "GET",
                    "datatype": "json"
                },
                "columns": [
                    { "data": "paraBirimiIliskiID", "width": "10%" },
                    { "data": "kaynakParaBirimiKodu", "width": "20%" },
                    { "data": "hedefParaBirimiKodu", "width": "20%" },
                    { "data": "cevrimKatsayisi", "width": "15%" },
                    { 
                        "data": "aktif", 
                        "width": "10%",
                        "render": function(data, type, row) {
                            return data ? '<span class="badge bg-success">Aktif</span>' : '<span class="badge bg-danger">Pasif</span>';
                        }
                    },
                    {
                        "data": null,
                        "width": "25%",
                        "render": function(data, type, row) {
                            return '<a href="@Url.Action("Details", "ParaBirimiIliski")/' + row.paraBirimiIliskiID + '" class="btn btn-info btn-sm me-1"><i class="fa fa-eye"></i> Detay</a>' +
                                '<a href="@Url.Action("Edit", "ParaBirimiIliski")/' + row.paraBirimiIliskiID + '" class="btn btn-primary btn-sm me-1"><i class="fa fa-edit"></i> Düzenle</a>' +
                                '<a href="@Url.Action("Delete", "ParaBirimiIliski")/' + row.paraBirimiIliskiID + '" class="btn btn-danger btn-sm"><i class="fa fa-trash"></i> Sil</a>' +
                                (row.aktif ? 
                                    '<button class="btn btn-warning btn-sm ms-1 pasifEtBtn" data-id="' + row.paraBirimiIliskiID + '"><i class="fa fa-ban"></i> Pasif Et</button>' : 
                                    '<button class="btn btn-success btn-sm ms-1 aktifEtBtn" data-id="' + row.paraBirimiIliskiID + '"><i class="fa fa-check"></i> Aktif Et</button>'
                                );
                        }
                    }
                ],
                "language": {
                    "url": "//cdn.datatables.net/plug-ins/1.11.5/i18n/tr.json"
                },
                "responsive": true
            });
        });
    </script>
} 